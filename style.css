
/* === 全画面を黒背景で確保 === */
html, body {
  height: 100%;
  margin: 0;
  background: #001f3f;
  /* 既定は固定。移動モード時は JS 側で auto に切り替える */
  overflow: hidden;
  font-family: "Noto Sans JP", sans-serif;
}

/* 安全策：クラス切り替えでも対応できるようにしておく（未使用でも害なし） */
body.asoble-scroll-ok {
    overflow: auto !important;
}
  html.asoble-scroll-ok {
    overflow: auto !important;
}

#stage {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: #001f3f;
  overflow: hidden;
}

/* 背景レイヤ（画像はJSが描画する。CSSで黒ベールを被せない） */
#bg-layer{
  position:absolute;
  inset:0;
  z-index:0;            /* ← キャンバスより下 */
  pointer-events:none;
  background:none;      /* ← 黒ベール禁止 */
  transform-origin:0 0;
}

/* 描画キャンバス */
#overlay{
  position:absolute;
  inset:0;
  z-index:2;            /* ← 前面 */
  display:block;
}

/* --- サイドパネル（必要なら） --- */

 #sidepanel{
   position:fixed; top:0; right:0; bottom:0; width:280px;
   background:rgba(0,0,0,0.85); color:#fff; padding:12px;
   overflow:visible; z-index:2147483647;
   font:12px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;
  transition: transform .25s ease;
 }
 #sidepanel input[type="range"]{ accent-color:#22d3ee; }

#sidepanel.is-closed{ transform: translateX(calc(100%)); }

#panel-handle{
  position:fixed; top:50%; right:0; transform: translateY(-50%);
  width:24px; height:56px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.85);
  color:#fff; border:1px solid rgba(255,255,255,0.3);
  border-radius:8px 0 0 8px;
  cursor:pointer; user-select:none;
  font:16px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;
  z-index:2147483648; /* パネルより前面 */
}

/* === Zoom toggle button: move to top-left === */
#zoom-toggle {
  top: 16px !important;
  left: 16px !important;
  right: auto !important;   /* ← 右固定を解除 */
}

/* === HUD (top-stats) === */
.top-stats{
    position:fixed; top:8px; left:10px; z-index:9999;
    font:600 12px/1.4 system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif;
    color:#fff; background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.08);
    border-radius:12px; padding:6px 12px; white-space:nowrap; pointer-events:none;
    box-shadow:0 3px 12px rgba(0,0,0,.18); letter-spacing:.2px; font-variant-numeric:tabular-nums;
  }
  .top-stats .ts-item{ display:inline-flex; align-items:baseline; gap:6px; }
  .top-stats .ts-key{ font-size:11px; opacity:.75; }
  .top-stats .ts-val{ font-size:15px; font-weight:700; letter-spacing:.2px; }
  .top-stats .ts-unit{ opacity:.65; }
  .top-stats .ts-sep{ display:inline-block; width:1px; height:14px; background:rgba(255,255,255,.18); margin:0 10px; vertical-align:middle; }
  
/* === HUDアニメーション（更新時の軽い強調） === */
.top-stats .ts-val{
  transition: transform .18s ease, color .18s ease, opacity .18s ease;
  will-change: transform, color;
}
.top-stats .ts-val.updated{
  transform: scale(1.12);
  color: rgba(255,255,255,.95);
  opacity: 0.98;
}

/* === 左ドロワー：ダッシュボード === */
#dashboard-panel{
  position: fixed; top:0; bottom:0; left:0; width: 380px;
  background: rgba(0,0,0,0.88); color:#fff;
  border-right: 1px solid rgba(255,255,255,0.12);
  box-shadow: 6px 0 18px rgba(0,0,0,0.35);
  padding: 10px 10px 12px; overflow: auto;
  z-index: 2147483646;
  font: 12px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;
  transform: translateX(0);
  transition: transform .25s ease;
}
#dashboard-panel.is-closed{ transform: translateX(calc(-100%)); }

/* 左ドロワーのハンドル（右と対になる見た目） */
#dashboard-handle{
  position:fixed; top:50%; left:0; transform: translateY(-50%);
  width:24px; height:56px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.85);
  color:#fff; border:1px solid rgba(255,255,255,0.3);
  border-radius:0 8px 8px 0;
  cursor:pointer; user-select:none;
  font:16px/1 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;
  z-index:2147483648;
}

/* ダッシュボード内部レイアウト（2カラム） */
#dashboard-panel .db-header{
  /* 2カラム：左=グラフ種別, 右=操作UI（db-controls） */
  display:grid; grid-template-columns:auto 1fr; align-items:center; gap:10px;
  position:sticky; top:0; background:rgba(0,0,0,0.9);
  padding:8px 8px; 
  /* ← 被りの原因となる負マージンを明示的に無効化 */
  margin:0 0 8px !important;
  border-bottom:1px solid rgba(255,255,255,0.08);
  z-index:5;  /* 被り回避で強める */
  min-height:44px; /* 潰れ防止 */
}

/* ヘッダ直下の内容が潜らないよう保険（既に大丈夫なら無害） */
#dashboard-panel .db-inner{ padding-top:0 !important; }
#dashboard-panel .db-header > label{ white-space:nowrap; }
#dashboard-panel .db-header .db-controls{ justify-content:flex-end; width:100%; }
#dashboard-panel .db-header select{
  background:#111; color:#fff; border:1px solid rgba(255,255,255,0.2);
  border-radius:8px; padding:4px 8px; font-size:12px;
  max-width:100%;
}

/* === 左パネル：操作UI（表示強化） === */
#dashboard-panel .db-controls{
  display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  padding:6px 6px; margin-left:auto;
  background: rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:10px;
  max-width:100%;
}

/* 設定パネル（.db-controls）の出し入れ・アニメ */
#dashboard-panel .db-controls{
  transition: max-height .22s ease, padding .22s ease, margin .22s ease, opacity .18s ease;
  max-height: 500px; /* 十分に大きく（中身より大きければOK） */
  opacity: 1;
}
#dashboard-panel .db-controls.is-collapsed{
  max-height: 0;
  padding-top: 0 !important;
  padding-bottom: 0 !important;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  overflow: hidden;
  opacity: .0;
}
/* 設定ボタンの簡易スタイル */
#dashboard-panel .db-gear{
  justify-self:end;
  appearance:none; border:1px solid rgba(255,255,255,.24);
  background:rgba(255,255,255,.06); color:#fff;
  border-radius:8px; padding:6px 10px; font-size:12px; cursor:pointer;
}
#dashboard-panel .db-gear:hover{ background:rgba(255,255,255,.12); }


/* モバイル等で折返し時ににじまないように */
#dashboard-panel .db-controls label{ white-space:nowrap; }

/* --- チップ式マシン選択 --- */
#dashboard-panel .chip-group{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; max-width:100%; }
#dashboard-panel .chip{
  appearance:none; border:1px solid rgba(255,255,255,0.24);
  background:rgba(255,255,255,0.06); color:#fff; border-radius:999px;
  padding:4px 10px; font-size:12px; cursor:pointer;
}
#dashboard-panel .chip:hover{ background:rgba(255,255,255,0.12); }
#dashboard-panel .chip.active{ border-color:#22d3ee; box-shadow:0 0 0 2px rgba(34,211,238,0.25); background:rgba(34,211,238,0.15); }
#dashboard-panel .chip.ctrl{ opacity:.9; }
/* 互換 select は常に非表示（JSで残す） */
#dashboard-panel select#db-machine{ display:none !important; }
/* SR-only（視覚非表示で読み上げ用） */
.sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
#dashboard-panel .db-controls label{
  display:flex; align-items:center; gap:6px; color:#fff; font-size:12px;
}
#dashboard-panel .db-controls select,
#dashboard-panel .db-controls input[type="number"]{
  appearance: none;
  background:#0b0b0b; color:#fff;
  border:1px solid rgba(255,255,255,0.25);
  border-radius:8px; padding:4px 8px; font-size:12px;
  outline:none;
}
#dashboard-panel .db-controls input[type="number"]{
  width:64px; text-align:right;
}
#dashboard-panel .db-controls select:focus,
#dashboard-panel .db-controls input[type="number"]:focus{
  border-color:#22d3ee; box-shadow:0 0 0 2px rgba(34,211,238,0.25);
}
#dashboard-panel .db-controls ::placeholder{
  color:rgba(255,255,255,0.5);
}

#dashboard-panel .db-inner{
  display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:start;
}
#dashboard-panel .db-graph, #dashboard-panel .db-stats{
  background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08);
  border-radius:12px; padding:10px;
}
#dashboard-panel #db-canvas{
  display:block; width:100%; height:260px; /* JSで実ピクセルを調整（Retina対応） */
}
#dashboard-panel .db-table{
  width:100%; font-variant-numeric: tabular-nums;
}
#dashboard-panel .db-row{
  display:grid; grid-template-columns: 1.5em 1fr; gap:8px; padding:6px 0;
  border-bottom:1px dashed rgba(255,255,255,0.08);
}
#dashboard-panel .db-row .kvs{
  display:grid; grid-template-columns: auto auto; gap:4px 8px;
}
#dashboard-panel .kv-key{ opacity:.75; }
#dashboard-panel .kv-val{ font-weight:600; }
#dashboard-panel .muted{ opacity:.65; font-size:11px; }

/* === 左ドロワー内スクロールバー（ダーク） === */
#dashboard-panel{
  scrollbar-color: rgba(160,160,160,.30) rgba(255,255,255,0.06); /* Firefox */
}
#dashboard-panel::-webkit-scrollbar{
  width:10px; height:10px;
}
#dashboard-panel::-webkit-scrollbar-track{
  background: rgba(255,255,255,0.06);
}
#dashboard-panel::-webkit-scrollbar-thumb{
  background: rgba(160,160,160,0.35);
  border-radius: 8px;
  border: 2px solid rgba(255,255,255,0.06);
}
#dashboard-panel::-webkit-scrollbar-thumb:hover{
  background: rgba(200,200,200,0.50);
}

